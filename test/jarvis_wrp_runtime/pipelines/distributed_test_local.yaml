# Local Distributed Test Pipeline
# Launches IOWarp runtime and runs distributed bdev tests on local machine

name: distributed_test_local

env:
  # Environment variables for local testing
  TEST_MODE: "local"

pkgs:
  # Stage 1: Launch IOWarp runtime
  - pkg_type: jarvis_wrp_runtime.wrp_runtime
    pkg_name: runtime
    sched_workers: 8
    process_reaper_workers: 1
    main_segment_size: "2G"
    client_data_segment_size: "1G"
    runtime_data_segment_size: "1G"
    zmq_port: 5555
    log_level: "info"
    stack_size: 65536
    queue_depth: 10000
    heartbeat_interval: 1000
    task_timeout: 30000

  # Stage 2: Run distributed tests
  - pkg_type: jarvis_wrp_runtime.wrp_distributed
    pkg_name: distributed_test
    num_nodes: 1
    test_case: "all"
    output_dir: "/tmp/wrp_distributed_local"
    verbose: true
