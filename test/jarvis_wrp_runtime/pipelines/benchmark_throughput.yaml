# BDev Throughput Benchmark Pipeline
# Purpose: Measures sustained BDev throughput with two modes:
#   1. I/O mode (io_size > 0): Continuous Allocate -> Write -> Free operations
#   2. Allocation-only mode (io_size = 0): Continuous AllocateBlocks -> FreeBlocks operations
# Each thread continuously performs operations until the duration timer expires
# Requirements: Chimaera installed in PATH
# Expected Runtime: Configurable via 'duration' parameter (default: 10 seconds)

name: benchmark_throughput

# Pipeline environment
env:
  # Use default Chimaera runtime configuration
  # CHI_SERVER_CONF will be set by wrp_runtime package

pkgs:
  # IOWarp Runtime Service
  - pkg_type: jarvis_wrp_runtime.wrp_runtime
    pkg_name: runtime
    # Runtime configuration
    sched_workers: 1
    process_reaper_workers: 1
    main_segment_size: "1G"
    client_data_segment_size: "512M"
    runtime_data_segment_size: "512M"
    zmq_port: 5555
    log_level: "info"
    stack_size: 65536
    queue_depth: 10000
    heartbeat_interval: 1000
    task_timeout: 30000
    sleep: 1

  # BDev Throughput Benchmark
  - pkg_type: jarvis_wrp_runtime.wrp_benchmark
    pkg_name: benchmark
    # Benchmark configuration
    threads: 1                      # Number of client threads
    duration: 10.0                  # Duration to run benchmark in seconds
    max_file_size: "1g"             # Maximum file size for BDev container
    io_size: "0"                   # I/O size per operation (set to 0 for allocation-only mode)
    lane_policy: "round_robin"      # Lane mapping: map_by_pid_tid, round_robin, random
    verbose: false                  # Print per-thread statistics
    output_dir: "/tmp/wrp_benchmark"
