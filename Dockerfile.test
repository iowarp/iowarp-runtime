# Dockerfile for running iowarp-runtime unit tests
# Based on iowarp/iowarp-deps:latest which includes all required dependencies
# Uses pre-built code from mounted host directories

FROM iowarp/iowarp-deps:latest

# Set working directory
WORKDIR /workspace

# Set environment variables for mounted modules
ENV HERMES_SHM_DIR=/ppi-jarvis-mods/cte-hermes-shm
ENV IOWARP_DIR=/ppi-jarvis-mods/iowarp-runtime
ENV PATH="${HERMES_SHM_DIR}/bin:${IOWARP_DIR}/bin:${PATH}"
ENV LD_LIBRARY_PATH="${HERMES_SHM_DIR}/lib:${IOWARP_DIR}/lib:${LD_LIBRARY_PATH}"
ENV CMAKE_PREFIX_PATH="${HERMES_SHM_DIR}:${IOWARP_DIR}:/usr/local"

# Set the default command to run all tests from pre-built code
CMD ["bash", "-c", "cd /workspace/build && ctest --output-on-failure"]
